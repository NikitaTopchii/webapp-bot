<div class="competition-creator">
  <div class="competition-creator__wrapper">
    <span class="competition-creator__title">Create competition</span>
    <div class="competition-creator__main-form">
      <form [formGroup]="form" (ngSubmit)="createCompetition(form)" class="form">
        <div class="competition-creator__name-block">
          <div>
            <label>Enter competition name</label>
            <input class="competition-creator__input-name formControl" formControlName="competitionName" autocomplete="off"/>
          </div>
          <div *ngIf="form.get('competitionName')?.hasError('required') && form.get('competitionName')?.touched">
            Competition name is required
          </div>
        </div>
        <div class="competition-creator__describe-block">
          <div>
            <label>Enter competition describe</label>
            <textarea class="competition-creator__textarea-description formControl" formControlName="competitionDescription"></textarea>
          </div>
          <div *ngIf="form.get('competitionDescription')?.hasError('required') && form.get('competitionDescription')?.touched">
            Description is required
          </div>
        </div>
        <div class="competition-creator__describe-block">
          <button *ngIf="setContestMedia" (click)="showContestMediaInput()" class="competition-creator__selector-button">enter contest media</button>
          <button *ngIf="!setContestMedia" (click)="showContestMediaInput()" class="competition-creator__selector-button">close</button>
          <label *ngIf="!setContestMedia">Enter media links</label>
          <input *ngIf="!setContestMedia" type="file" (change)="onFileSelected($event)">
          <p *ngIf="form.controls['media'].hasError('invalidFileType')">Only photo and video is allowed here</p>
        </div>
        <div class="competition-creator__describe-block">
          <button *ngIf="setContestData" (click)="showContestDataInput()" class="competition-creator__selector-button">enter contest date</button>
          <button *ngIf="!setContestData" (click)="showContestDataInput()" class="competition-creator__selector-button">close</button>
          <mat-form-field appearance="fill" *ngIf="!setContestData">
            <mat-label>Enter a date range</mat-label>
            <mat-date-range-input [rangePicker]="picker">
              <input
                readonly
                matStartDate
                formControlName="startDate"
                placeholder="Start date"
                (dateChange)="handleDateChanged('start',$event)"
              />
              <input
                readonly
                matEndDate
                formControlName="endDate"
                placeholder="End date"
                (dateChange)="handleDateChanged('end',$event)"
              />
            </mat-date-range-input>
            <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
            <mat-date-range-picker #picker></mat-date-range-picker>
          </mat-form-field>
        </div>
        <div class="competition-creator__date-format" [class.__failed]="failedDateValidation">
          <button *ngIf="setContestTime" (click)="showContestTimeInput()" class="competition-creator__selector-button">enter contest time</button>
          <button *ngIf="!setContestTime" (click)="showContestTimeInput()" class="competition-creator__selector-button">close</button>
          <label *ngIf="!setContestTime">Enter contest start time in format: hh:mm</label>
          <input *ngIf="!setContestTime" class="competition-creator__input-name formControl" formControlName="competitionStartTime" autocomplete="off"/>
          <label *ngIf="failedDateValidation" class="competition-creator__error-message">enter valid time format</label>
        </div>
        <div *ngIf="form.get('competitionStartTime')?.hasError('required') && form.get('competitionStartTime')?.touched">
          Time is required
        </div>
        <div *ngIf="form.get('competitionStartTime')?.hasError('pattern')">
          String is not valid. Please use format HH:MM
        </div>
        <div class="competition-creator__date-format" [class.__failed]="failedDateValidation" *ngIf="!setContestTime">
          <label>Enter contest final time in format: hh:mm</label>
          <input class="competition-creator__input-name formControl" formControlName="competitionFinishTime" autocomplete="off"/>
          <label *ngIf="failedDateValidation" class="competition-creator__error-message">enter valid time format</label>
        </div>
        <div *ngIf="form.get('competitionFinishTime')?.hasError('required') && form.get('competitionFinishTime')?.touched">
          Time is required
        </div>
        <div *ngIf="form.get('competitionFinishTime')?.hasError('pattern')">
          String is not valid. Please use format HH:MM
        </div>
        <div class="competition-creator__date-format">
          <button *ngIf="setContestWinnersCount" (click)="showContestWinnersCount()" class="competition-creator__selector-button">enter winners count</button>
          <button *ngIf="!setContestWinnersCount" (click)="showContestWinnersCount()" class="competition-creator__selector-button">close</button>
          <label *ngIf="!setContestWinnersCount">Enter count of winners: </label>
          <input *ngIf="!setContestWinnersCount" class="competition-creator__input-name formControl" formControlName="competitionWinnersCount" autocomplete="off"/>
        </div>
        <div *ngIf="form.get('competitionWinnersCount')?.hasError('required') && form.get('competitionWinnersCount')?.touched">
          Count of winners is required
        </div>
        <div *ngIf="form.get('competitionWinnersCount')?.hasError('pattern')">
          Only numbers are allowed
        </div>
        <div class="competition-creator__language-selector">
          <button *ngIf="setContestLanguage" (click)="showContestLanguageInput()" class="competition-creator__selector-button">enter contest language</button>
          <button *ngIf="!setContestLanguage" (click)="showContestLanguageInput()" class="competition-creator__selector-button">close</button>
          <label *ngIf="!setContestLanguage">
            <input type="radio" formControlName="languageSelector" value="ru">
            ru
          </label>
          <label *ngIf="!setContestLanguage">
            <input type="radio" formControlName="languageSelector" value="en">
            en
          </label>
        </div>
        <div class="competition-creator__conditions-block">
          <mat-chip-listbox aria-label="Contest selection" formControlName="selectedBaseCondition">
            <mat-chip-option color="accent" selected [disabled]="true">subscribe</mat-chip-option>
          </mat-chip-listbox>
          <mat-chip-listbox aria-label="Contest selection" formControlName="selectedCondition">
            <mat-chip-option (click)="showConditionTypes()">condition</mat-chip-option>
            <mat-chip-option (click)="showGuessNumberCondition()">guess number</mat-chip-option>
          </mat-chip-listbox>
        </div>
        <div class="competition-creator__condition-selector">
          <div class="competition-creator__conditions" *ngIf="conditionTypes">
            <p class="competition-creator__checkbox-text"><mat-checkbox formControlName="emailCondition">email</mat-checkbox></p>
            <p class="competition-creator__checkbox-text"><mat-checkbox formControlName="phoneCondition">phone</mat-checkbox></p>
            <p class="competition-creator__checkbox-text"><mat-checkbox formControlName="selfCondition" (click)="showSelfConditionBuilder()">self</mat-checkbox></p>
            <div class="competition-creator__self-condition-builder" *ngIf="setSelfConditionBuilder">
              <label>Enter self condition</label>
              <input class="competition-creator__input-name" formControlName="selfConditionName" autocomplete="off"/>
              <label>
                <input type="radio" formControlName="selfConditionTypes" value="text">
                text
              </label>
              <label>
                <input type="radio" formControlName="selfConditionTypes" value="number">
                number
              </label>
              <label>
                <input type="radio" formControlName="selfConditionTypes" value="image">
                image
              </label>
              <label>
                <input type="radio" formControlName="selfConditionTypes" value="video">
                video
              </label>
              <label>
                <input type="radio" formControlName="selfConditionTypes" value="link">
                link
              </label>
            </div>
          </div>
          <div class="competition-creator__guess-number-condition" *ngIf="setGuessNumberCondition">
            <label>Enter number</label>
            <input class="competition-creator__input-name" formControlName="guessNumber" autocomplete="off"/>
            <label>
              <input type="radio" formControlName="guessNumberCondition" value="exact">
              exact value
            </label>
            <label>
              <input type="radio" formControlName="guessNumberCondition" value="closest">
              closest value
            </label>
          </div>
        </div>
        <div class="competition-creator__list-of-channels">
          <div *ngFor="let channels of getSelectedChannels()" class="competition-creator__element-of-channels-list">
            <span>{{channels.name}}</span>
          </div>
        </div>
        <button type="submit" class="competition-creator__button" [disabled]="!form.valid">create competition</button>
      </form>
    </div>
  </div>
</div>
